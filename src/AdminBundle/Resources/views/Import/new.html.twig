{% extends 'layoutAdminDefault.html.twig' %}
{% block body %}
 <section id="main-content">
    <section class="wrapper"> 
        <div class="row">
            <div class="col-lg-12">
                <section class="panel panel-default" style='margin-bottom: 0px'>
                    <header class="panel-heading">
                        Import Creation
                    </header>
                    <div class="panel-body">
                        {{ form_start(form, {'attr': {'class': 'form-validate form-horizontal', 'novalidate': 'novalidate'}}) }}
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-lg-9 col-md-9 col-sm-9">
                                        <div class="col-md-6">
                                            {{ form_label(form.provider, 'Provider') }}
                                            
                                            <div class="input-group">
                                                {% set _class = 'form-control' %}
                                                {% if not form.provider.vars.valid %}
                                                    {% set _class = 'form-control error' %}
                                                {% endif %}
                                                {{ form_widget(form.provider, {'attr': {'class': _class}}) }}
                                                <div class="input-group-addon">
                                                    <span class="fa fa-plus"></span>
                                                </div>
                                            </div>

                                            {{ form_errors(form.provider) }}
                                        </div>

                                        <div class="col-md-6">
                                            {{ form_label(form.import_details.vars.prototype.product, 'Product') }}
                                            
                                            <div class="input-group">
                                                {% set _class = 'form-control' %}
                                                {% if form.import_details.__name__.product.vars.valid is defined and form.import_details.__name__.product.vars.valid == FALSE %}
                                                    {% set _class = 'form-control error' %}
                                                {% endif %}
                                                {% if form.import_details.children.__name__.product is defined %}
                                                    {{ form_widget(form.import_details.children.__name__.product, {'attr': {'class': _class}}) }}
                                                {% else %}
                                                    {{ form_widget(form.import_details.vars.prototype.product, {'attr': {'class': _class}}) }}
                                                {% endif %}
                                                <div class="input-group-addon">
                                                    <span class="fa fa-plus"></span>
                                                </div>
                                            </div>

                                            {% if form.import_details.__name__.product is defined %}
                                                {{ form_errors(form.import_details.__name__.product) }} 
                                            {% endif %}
                                        </div>

                                        <div class="col-md-4">
                                            {{ form_label(form.import_details.vars.prototype.quantity, 'Quantity') }}

                                            {% set _class = 'form-control number-input' %}
                                            {% if form.import_details.__name__.quantity.vars.valid is defined and form.import_details.__name__.quantity.vars.valid == FALSE %}
                                                {% set _class = 'form-control number-input error' %}
                                            {% endif %}
                                            {% if form.import_details.children.__name__.quantity is defined %}
                                                {{ form_widget(form.import_details.children.__name__.quantity, {'attr': {'class': _class}}) }}
                                            {% else %}
                                                {{ form_widget(form.import_details.vars.prototype.quantity, {'attr': {'class': _class}}) }}
                                            {% endif %}

                                            {% if form.import_details.__name__.quantity is defined %}
                                                {{ form_errors(form.import_details.__name__.quantity) }} 
                                            {% endif %}
                                        </div>
                                        
                                        <div class="col-md-4">
                                            {{ form_label(form.import_details.vars.prototype.unitPrice, 'Unit Price') }}
                                            
                                            {% set _class = 'form-control number-input' %}
                                            {% if form.import_details.__name__.unitPrice.vars.valid is defined and form.import_details.__name__.unitPrice.vars.valid == FALSE %}
                                                {% set _class = 'form-control number-input error' %}
                                            {% endif %}
                                            {% if form.import_details.children.__name__.unitPrice is defined %}
                                                {{ form_widget(form.import_details.children.__name__.unitPrice, {'attr': {'class': _class}}) }}
                                            {% else %}
                                                {{ form_widget(form.import_details.vars.prototype.unitPrice, {'attr': {'class': _class}}) }}
                                            {% endif %}
                                            
                                            {% if form.import_details.__name__.unitPrice is defined %}
                                                {{ form_errors(form.import_details.__name__.unitPrice) }} 
                                            {% endif %}
                                        </div>

                                        <div class="col-md-4">
                                            {{ form_label(form.total, 'Total') }}
                                            {% set _class = 'form-control' %}
                                            {% if not form.total.vars.valid %}
                                                {% set _class = 'form-control error' %}
                                            {% endif %}
                                            {{ form_widget(form.total, {'attr': {'class': _class}}) }}
                                            {{ form_errors(form.total) }}
                                        </div>

                                        <div class="col-md-6">
                                            {{ form_label(form.note, 'Note') }}
                                            {{ form_widget(form.note, {'attr': {'class': 'form-control col-xs-12', 'rows': 3}}) }}
                                            {{ form_errors(form.note) }}
                                        </div>

                                        <div class="col-md-6">
                                            {{ form_label(form.payment, 'Payment') }}
                                            {{ form_widget(form.payment, {'attr': {'class': 'form-control', 'rows': 3}}) }}
                                            {{ form_errors(form.payment) }}
                                        </div>                
                                    </div>
                          
                                    <div class="col-lg-3 col-md-3 col-sm-3" style="padding-top:20px">
                                        <div class="form-group">
                                            <img id="product_image" height="210" width="210" src="#" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                      
                            <div class="row">
                                <div class="col-lg-12">
                                    <input class="btn btn-primary" type="submit" value="Create">
                                    <a class="btn btn-default" href="{{ path('import_index') }}">Back to the list</a>
                                </div>
                            </div>
                            {{ form_widget(form.import_details, {'attr': {'class': 'hidden'}}) }}
                        {{ form_end(form) }}  
                    </div>
                </section>
                <section class="panel panel-default">
                    <header class="panel-heading no-border">
                        Import Details
                    </header>
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Bill id</th>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2</td>
                                <td>Jacob</td>
                                <td>Thornton</td>
                                <td>@fat</td>
                                <td>@fat</td>
                                <td>
                                    <div class="btn-group">
                                        <a class="btn btn-danger" href="#">Delete</a>
                                    </div>
                                    <div class="btn-group">
                                        <a data-toggle="modal" data-target="#editModal" class="btn btn-success" href="#">Edit</a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
    </section>
</section>
{% endblock body %}
{% block javascripts %}
{{ parent() }}
<script type="text/javascript">
    $(document).ready(function() {
        addImageByAjax();
    });

    $( "#admin_import_import_details___name___product" ).change(function() {
        addImageByAjax();
    });

    function addImageByAjax() {
        var id = $("#admin_import_import_details___name___product option:selected").val();
        $.ajax({
            url: "/admin/product/info",
            type: "POST",
            data: { id : id },
            dataType: 'json',
            success: function(data) {
                if(data.status == 1) {
                    var image = !data.product.image ? 'https://www.oatey.com/ASSETS/IMAGES/ITEMS/DETAIL_PAGE/NoImage.png' : '/' + data.product.image;
                    $('#product_image').attr('src', image);
                }
            },
            error: function (xhr, status, error) {
                //console.log(xhr.responseText);
            }
        });
    }

    $(document).ready(function() {
        $('.number-input').keyup(function(e) { 
            var charCode = (e.which) ? e.which : e.keyCode;
            if((e.keyCode >= 48 && e.keyCode <=57) || (e.keyCode >= 96 && e.keyCode <=105)) { 
                return;
            } 
            $('.number-input').val('');
        });
    });
</script>
{% endblock javascripts %}
